# 中央处理器

## 中央处理器的组成和功能

### CPU的功能

中央处理器：控制程序按设定方式执行。

CPU的主要功能：

- 指令控制：顺序寻址和跳跃寻址
  
  控制程序的执行顺序

- 操作控制：对指令操作码译码之后产生控制信号。
  
  产生和发送各操作信号

- 时间控制：维持各类操作的时序关系
  
  控制指令或操作的实施时间

- 数据加工：ALU完成具体的运算
  
  对数据进行算术和逻辑运算

### CPU的基本组成

现代CPU的组成：运算器、控制器、片内cache

控制器的主要功能：

- 从内存中取出一条指令，并指出下条指令的存放位置
  
  `PC`， `IR`寄存器

- 对指令进行译码，产生相应的控制信号

- 控制CPU、内存和输入输出设备之间的数据流动

运算器的主要功能：

- 执行所有的算术运算

- 执行所有的逻辑运算并进行逻辑测试

![](./cpu/2023-04-06-16-02-15-image.png)

### CPU中的主要寄存器

1. 数据缓冲寄存器
   
   暂时存放ALU的运算结果或者CPU与外界传输的数据
   
   - 作为ALU运算结果同通用寄存器之间的信息传送中时间上的缓冲
   
   - 补偿CPU和内存、外围设备之间在操作速度上的差别

2. 通用寄存器
   
   暂时存放ALU的运算结果或者运算数据

3. 状态条件寄存器`PSW`
   
   保存各种状态和条件控制信号，例如进位标志`C`，溢出标志`V`
   
   每个信号由一个触发器保存，从而拼成一个寄存器

4. 地址寄存器
   
   保存当前CPU所访问数据的内存单元地址。
   
   主要用于解决主存/外设同CPU之间的速度差异，使地址信息能够保持到主存/外设的读写操作完成

5. 程序计数器
   
   始终存放下一条指令的地址，对于指令Cache的访问
   
   内容变化有着两种情况：
   
   - 顺序执行：PC+1->PC
   
   - 转移执行：指令->PC

6. 指令寄存器
   
   保存当前正在执行的指令
   
   指令寄存器中操作码字段的输出就是指令译码器的输入

### 操作控制器与时序产生器

数据通路：寄存器之间传送信息的通路

操作控制器：根据指令操作码和时序信号，产生各种操作控制信号。简历正确的数据通路，从而完成指令的执行。

- 硬布线控制器：利用时序逻辑实现

- 微程序控制器：采用存储逻辑实现

- 前两种方式的结合

时序控制器：对各种操作实施时间的限制。

## 指令周期

### 指令周期的基本概念

CPU执行程序是一个”取指令-执行指令“的循环过程。

指令周期：CPU从内存中取出一条指令并执行的时间总和。

> CPU周期：机器周期，一般为从内存中读取一条指令字的最短时间。一个CPU周期可以完成CPU的一个基本操作。
> 
> 时钟周期：也叫节拍脉冲或者T周期，是计算机处理操作的基本时间单位。

一个完成的指令周期由若干机器周期构成：

取值周期->间值周期->执行周期->中断周期

> 本教材上间址周期和执行周期统称为执行周期。

### `MOV R0, R1`指令的指令周期

`mov`是一条RR型指令，它需要两个CPU周期。

- 取值周期：从储存器中取出指令，程序计数器加1，译码或者测试指令操作码，输出控制信号。
  
  1. PC->ABUS->指令Cache, 译码并启动
  
  2. 指令Cache->IR
  
  3. PC->PC+1, 为取下一条指令做好准备
  
  4. IR中的操作码被译码或者测试，识别出是指令`mov`

- 执行周期：在控制信号的作用下，将R1中的数据通过ALU送入R0
  
  1. R1->ALU, 数据是通过ALU传送的
  
  2. ALU->DBUS->DR->R0

![](./cpu/2023-04-06-16-50-04-image.png)

### `LAD R1, 6`指令的周期

`LAD`指令是RS型指令，需要方寸获取操作数，共包含三个CPU周期。

- 取值周期

- 间址周期：从IR的地址码字段获得操作数的地址
  
  1. IR->DBUS->AR 该过程为寻址周期
  
  2. AR->ABUS->数据cache 译码并启动
  
  3. 数据cache->DBUS->DR->R1

- 执行周期：访存获取操作数送入通用寄存器

![](./cpu/2023-04-06-17-19-37-image.png)

### `ADD R1, R2`指令的指令周期

`ADD`指令的指令周期由两个CPU周期组成。

- 取值周期

- 执行周期
  
  1. R1, R2 -> ALU
  
  2. ALU 进行加运算，将两数相加
  
  3. ALU->DBUS->DR->R2，保存结果

![](./cpu/2023-04-06-17-28-10-image.png)

### `STO R2, (R3)`指令的指令周期

`STO`指令是RS型指令，需要3个CPU周期。

- 取值周期

- 间址周期：根据R3中的地址寻址所要访问的存储单元
  
  1. R3->DBUS->AR, 发送地址启动数据Cache
  
  2. R2->DBUS->数据Cache

- 执行周期：将寄存器R2中的数据送入指定的存储单元

![](./cpu/2023-04-06-17-31-07-image.png)

### `JMP 101`指令的指令周期

`JMP`指令是一条无条件转移指令，用来改变程序的执行顺序

- 取值周期

- 执行周期：使用`JMP`指令中的直接地址为PC赋值
  
  IR->DBUS->PC

![](./cpu/2023-04-06-17-33-12-image.png)

### 用方框图语言表示指令周期

方框：代表一个CPU周期，内容表示数据通路的操作或者某种控制操作

菱形：通常表示某种判别或者测试，时间上依附于之前一个方框的CPU周期，而不单独占用一个CPU周期

公操作符号`~`：表示一条指令已经执行完毕，转入公操作

> 所谓公操作就是对一条指令执行完毕之后，CPU所开始的一些操作，比如对外围设备请求的处理等


