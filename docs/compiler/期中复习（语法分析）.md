# 复习









## 第四章 语法分析

### 递归调用预测





### 非递归调用预测

#### FIRST（X）的构造

![image-20231028205809858](assets/image-20231028205809858.png)

构造：

![image-20231028205827275](assets/image-20231028205827275.png)

即：

- 若$X$是终结符$a$，则$FIRST(X)=\{a\}$
- 若$X\rightarrow\epsilon$，则放入$\epsilon$
- 若$X\rightarrow终结符a……$，则放入$a$
- 若$X\rightarrow非终结符Y……$，而$Y\rightarrow b……$，则放入b
- 若$X\rightarrow Y_1Y_2……$，而$Y_1\rightarrow\epsilon$，则将$Y_2$视做上一条的Y，以此类推
- 若$X\rightarrow Y_1Y_2……Y_n$，且$Y_1Y_2……Y_n$都可推出$\epsilon$，则X可推出$\epsilon$

#### FOLLOW（x）的构造

![image-20231028210936688](assets/image-20231028210936688.png)

构造：

![image-20231028210949529](assets/image-20231028210949529.png)

即：

- 若某一非终结符号A在S可推出的任意一个串中处于最后的位置，那么$\$ \in FOLLOW(A)$。
- 对文法开始符号$S$，$\$ \in FOLLOW(S)$。
- 若有$A\rightarrow \alpha B \beta$，即若有一产生式，可以推出$B$后面存在一个**非空的符号**（终结/非终结都行），那么这个符号的first放进B的follow，即：$FIRST(\beta) \in FOLLOW(B)$。
- 若有$A\rightarrow \alpha B \beta$，且存在$\beta \rightarrow \epsilon$，或没有这个$\beta$。即若有一产生式，可以推出**$B$后面为空**，那么A的follow放进B的follow，即：$FOLLOW(A) \in FOLLOW(B)$。如果A的follow还没算出来可以暂缓。如果按照上面的规则有$FOLLOW(A) \in FOLLOW(A)$的情况，认为前一个$FOLLOW(A)$为空。
  - 对于此规则，是因为：当$A\rightarrow \alpha B$时，![image-20231106205756432](assets/image-20231106205756432.png)

#### LL（1）预测分析表

![image-20231028225224187](assets/image-20231028225224187.png)

如果$A \rightarrow ……$可以推出$\epsilon$，则对于$FOLLOW（A）$中的每个符号b，在表中[A，b]的位置都放入对应的产生式

此外，对于产生式右部的FIRST集合中的每个符号a，在表中[A，a]的位置都放入对应的产生式

（注：比如aAABB，那么first就是第一个终结符a，因为在这里找到了第一个终结符，就结束了）

如：

![image-20231028225749047](assets/image-20231028225749047.png)



**LL(1)文法**

![image-20231028225941799](assets/image-20231028225941799.png)

如果上表（预测分析表）中，每一个格子中都不存在两个及以上的产生式，那么就是LL（1）文法。而上表就不是。（含有左递归的必然不是）

或根据产生式判断：![image-20231028230013592](assets/image-20231028230013592.png)



**带错误恢复的（同步回退）**

![image-20231028230235988](assets/image-20231028230235988.png)



### 自底向上预测

#### 冲突

- $A\rightarrow ·a 与A\rightarrow SA·$共存时，前者点后面是终结符要移进，后者点在末尾要规约，所以移进-规约冲突
- $B\rightarrow SA· 与A\rightarrow SA·$共存时，两者都满足规约，所以规约-规约冲突

有冲突则不是LL（1）文法

#### LR（0）

##### closure（I）

![image-20231104231535678](assets/image-20231104231535678.png)

LR0的简单。先放进原项目，然后对点后面的符号，如果是非终结符，将他的产生式全扔进去（点在开头），如此循环进行即可。

##### go

点向后移，将结果取closure。（如果移之后到达末尾，closure不变）

##### 有效项目集规范族

对拓广文法是$S'\rightarrow S$取closure作为$I_0$，然后对每一个点后面的的符号取go，作为新的$I_x$。

![image-20231104232202482](assets/image-20231104232202482.png)

可简化，直接画图：

![image-20231104232216214](assets/image-20231104232216214.png)

##### SLR（1）分析表

如何避免冲突不用去记（若要快速预测，见下图例），按照下面固定的做法取填表即可  如果填完还是冲突，则不为SLR（1）文法。

![image-20231105201532549](assets/image-20231105201532549.png)

（若为规约-规约冲突，则构造两者式子左端的FOLLOW，输入字符属于哪个，就规约哪个）

- 构造上述规范族$I_x$
- action（终结符以及$符的表）：

  - 若$I_i$中有$A\rightarrow \alpha · a \beta$，且$go(I_i,a)=I_j$，即状态i可以通过a达到状态j，那么$action[i，a]=Sj$，表示移入操作，且转移到状态j
  - 若$I_i$中有$A\rightarrow \alpha · $，且有产生式$A\rightarrow \alpha $，则可以将$\alpha$用A替换来完成规约，对于所有的$a\in FOLLOW(A)$，记作$action[i，a]=Rj$，其中j是该产生式的编号，A不为S'。
  - 若$I_i$中有$S' \rightarrow S · $，则$action[i，\$]=Acc$，表示分析结束，成功
- $goto$表
  - 若$go(I_i,A) = I_j$，A为非终结符，则$goto[i,A]=j$
- 其余地方填err

若不含有冲突，则为SLR（1）

- **LR（0）还是SLR（1）？**

当且仅当在每个$I_i$中，最多只含有一个规约项目，才为LR（0）

#### LR（1）

##### closure（I）

与LR（0）的类似，但是在得到一个LR（0）中可以扔进去闭包的$B\rightarrow \lambda$时，还需要对所有$b\in FIRST(\beta a)$加入到$B\rightarrow \lambda$中。此处a是$[A\rightarrow \alpha ·B\beta,a]$这一闭包中已有产生式的后部符号，$\beta$是点后面的非终结符再后面的所有符号串，若到达结尾则视为$\epsilon$

因此：

- 若B后面是不为空的非终结符，则结果不可能包含$
- 

例：

![image-20231105204403912](assets/image-20231105204403912.png)

此图中，S'是原始，然后S的两个式子是第一轮；然后在第二轮，L的两个式子中，只能推出右部为等号的，而没有\$符，以及R的式子；第三轮，R的式子才可以推出L的两个式子中的\$符。

中间两节同上，无变化

##### LR（1）分析表

仅对规约项稍作修改即可：从对于所有的$a\in FOLLOW(A)$，记作$action[i，a]=Rj$，变为仅对LR(1)项目右部的a/b/……记作$action[i，a]=Rj，action[i，b]=Rj ……$。

若不含冲突，则为LR（1）

#### LALR（1）

同心集：对LR（1）文法，忽略项目右部之后，可能存在两个状态集相同，则他们处于同一个同心集，可以被合并。而合并之后必然最多只会有归约-归约冲突。

（冲突的出现：）![image-20231105223831199](assets/image-20231105223831199.png)

![image-20231105223842626](assets/image-20231105223842626.png)

若合并后存在冲突，则不存在LALR（1）分析表；若没有冲突，则如下构造：

同LR（1），只不过每一步的操作从$I_i$变成了合并同心集之后的$J_i$。



推理：

先reduce，再填符号栈，然后根据顶部的符号和状态填入状态栈

![image-20231107092623940](assets/image-20231107092623940.png)



![image-20231107081311719](assets/image-20231107081311719.png)
