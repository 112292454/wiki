# 传输层

## 传输层所在的功能和位置

传输层是网络网络分层模型中较为重要的一层，提供了端到端的可靠、高效、低开销的数据传输服务，而且同当前的物理设备和网络无关。

传输层提供了进程到进程级别的通信传输服务：

![image-20230523152502659](./transport-layer/image-20230523152502659.png)

### 传输层提供的服务

- 屏蔽了通信网络的复杂性并向上层提供了同一的通信接口
- 通过单一的网络接口提供了多个服务访问点`Service Access Points`
- 提供了面向连接和无连接两种服务

伯克利的套接字是目前在互联网上被广泛应用的传输层API：

![image-20230523154634286](./transport-layer/image-20230523154634286.png)

![image-20230523154658014](./transport-layer/image-20230523154658014.png)

## 传输协议的重点

### 传输层协议和数据链路层协议的比较

都需要处理差错控制、序列、流量控制等等问题。

但是数据链路层是节点到节点的传输，传输层是进程到进程。

两者所在的环境是也不太相同：

- 不同的地址
- 连接建立的过程不同
- 不同子网的容纳量不同
- 缓冲的分配方式不同

### 地址编码方式：端口号

决定不同的进程应该如何发送和收到不同的信息，也就是应用层进程的服务提供点。

不同的端口号还提供了复用的功能：

- 对于发送方：通过端口号区分从不同进程发送的数据包，实现对于传输层的复用
- 对于接收方：通过端口号区分从不同进程接受的数据包，实现对于传输层的复用

### 连接建立过程中的问题

基础的连接建立过程是通过两次握手：一方发送一个连接请求然后等待另一方发送一个接受连接的回复。

但是存在问题：网络传输过程中可能存在延迟，导致重复的连接：

![image-20230523160209470](./transport-layer/image-20230523160209470.png)

通过三次握手就可以结果建立连接重复的问题：

![image-20230523160517039](./transport-layer/image-20230523160517039.png)

在释放连接的过程中也存在着类似的问题：也可以通过类似的三次握手消息来解决。

![image-20230523160757503](./transport-layer/image-20230523160757503.png)

![image-20230523160823428](./transport-layer/image-20230523160823428.png)

### 差错控制

差错控制使用了自动请求重传的机制，提供了进程到进程的差错控制。

