# 介质访问控制子层

## 信道分配问题

一般来说，共享信道有着下面几种方式：

![](./mac/2023-03-31-10-00-20-image.png)

在图中：

- `SDTM`表示**同步**时分复用
  
  将时间分成不同的时间片，不同的设备轮流使用介质发送或者接受数据。每个设备都会得到固定长度的时间片供其使用，如果没有使用这个时间片就浪费了。

- `ADTM`表示**异步**时分复用，也被称作统计复用。

对于局域网来说，静态信道分配（`FDM`、`STDM`）工作的并不良好。

为了说明为什么工作的不好，我们首先引入一个公式：

$$
T=\frac{1}{u-\lambda}
$$

在公式中：

- $u$表示平均服务速度

- $\lambda$表示平均到达时间

- $T$表示平均等待时间

如果信道被平均分配到`N`个静态的子信道：

通过公式可以计算出平均等待时间变成了原来的`N`倍。

$$
T=\frac{1}{\frac{uC}{N}-\frac{\lambda}{N}}=NT
$$

而信道的平均服务速率和平均到达速率均变成了原来的`N`分之一。

因此静态信道分配表现并不好：

- 如果信道被分配为多个子信道：
  
  - FDM：延迟相对于原来大大增加
  
  - TDM：存在一些问题

- 在面对互联网上常见的突发请求处理均不好

因此我们常用动态信道分配。

### 动态信道分配的分类

- 随机访问
  
  - `ALOHA`
  
  - `CSMA`，`CSMA/CD`，`CSMA/CA`

- 控制访问
  
  - 中心化的控制：轮询
  
  - 去中心化的控制：令牌

### 动态信道分配中涉及的假设

- 每个站点之间都是相互独立的，且是单用户系统

- 只用一个可用的信道

- 如果发送冲突则数据就废弃了

- 时间分配：
  
  - 连续时间分配：随时均可以占用信道时间
  
  - 分时隙：必须等待一个周期（称作**时隙**）开始才能占用

- 载波监听：发送之前能否判断信道是否被占用
  
  - 提供载波监听
  
  - 没有载波监听

> 时间分配和载波监听都是设计协议时需要二选一的选项

## 介质访问协议

主要注意协议中是如何侦测冲突和从冲突中恢复的。

### ALOHA

#### 纯ALOHA Pure ALOHA

第一个提供介质访问控制功能的协议，简单但是富有研究价值。

不使用时隙机制和载波监听。

协议的基本设计就是依赖确认帧来判断是否发生冲突：

- 每个站点不考虑是否冲突，在需要传输的时候直接发送数据帧

- 如果没收到确认帧就重复发送

![](./mac/2023-03-31-10-31-49-image.png)

注意在流程图中，为了避免总是发生冲突，协议中设计了一个随机的等待时间`k`。

为了衡量不同协议的性能，首先引入一系列参数：

首先用**帧时**$T_0$表示发送一个标准的、固定长度的帧需要的时间，同时假定站点产生的新帧符合一个帧时上产生`N`个帧的泊松分布，可以定义以下两个量表示协议的性能：

- 吞吐量`S`，在一个帧时中成功传输的帧数

- 网络负载`P`，在一个帧时中到达的帧

不难发现存在下面这个关系：

$$
S=G \times P(成功传输)
$$

一个帧被成功发送需要的条件是：在帧发送和传输的工程中没有帧到达。这段时间被称作**脆弱期**，这段时间的长度是$2T_0$，利用这个值可以得出：

$$
S \le 18.4\%
$$

#### 含有时隙的ALOHA Slotted ALOHA

- 将时间分成帧时长度的时隙

- 需要一个中央时钟，或者某种同步机制

- 传输必须在时隙开始时才能开始
  
  ![](./mac/2023-03-31-10-48-04-image.png)

- 这是帧发送的脆弱期变为原来的一半：$T_0$

改进之后的协议吞吐量变成了原来的两倍：

$$
S \le 36.8\%

$$

### 载波监听多点访问

Carrier Sense Multiple Access Protocols，简称`CSMA`。

这种协议的基本设计思想是：在发送信息之前监听信道。

监听信道有着两种方式：

- 坚持听：一直监听信道，直到空闲

- 周期监听：周期性的监听信道，直到发现空闲

发现信道空闲之后是否发送也有着两种方式：

- 1坚持：遇到空闲直接发送

- P坚持：以概率P决定是否发送还是继续监听

这种协议的脆弱期就是信号在介质传播的时延。

![](./mac/2023-03-31-11-03-00-image.png)

#### 不同CSMA协议的比较

- 1坚持的CSMA
  
  当负载比较低的时候，吞吐量比较大且时延比较低。
  
  当负载比较高的时候，吞吐量比较低。

- 非坚持的CSMA
  
  当负载比较高的时候，吞吐量高。

### 带冲突检测的载波监听多路访问

CSMA with Collision Detection，简称CSMA/CD。

协议的基本思想：在发送数据的同时监听信道，如果发现冲突就停止发送。

- 如果冲突被发现了，停止发送数据，发送一系列的**强化信号**提醒所有的站点冲突发生了

- 发送强化信号之后，等待一段随机的时间

- 这就构成了一个半双工的系统

- 节约了时间和带宽

- 是以太网的基础

CSMA/CD协议有着三个状态：

- 发送期`transmission`

- 争用期`contention`

- 空闲期`idle`

争用期这个状态比较复杂：

![](./mac/2023-03-31-12-19-23-image.png)


